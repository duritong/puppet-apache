  <Proxy *>
<% if (@htpasswd_file && @htpasswd_file.to_s == 'absent') && !@configuration.key?('auth_mellon') -%>
    Require all granted

<% end -%>
<% if @configuration['authenticated_location'] -%>
<% if @configuration.key?('auth_mellon') -%><%= scope.call_function('template',['apache/vhosts/partials/auth_mellon_config.erb']) %><% end -%>
  </Proxy>

  <Location <%= @configuration['authenticated_location'] %>>
<%= scope.call_function('template',['apache/vhosts/partials/authentication.erb']) %>
<%= @configuration['authenticated_location_extra_conf'] %>
  </Location>
<% else -%>
<%= scope.call_function('template',['apache/vhosts/partials/authentication.erb']) %>
  </Proxy>
<% end -%>

  <%= @configuration['early_extra_conf'] %>
  ProxyRequests Off
<% Array(@configuration['exclude_paths_from_proxy']).each do |path| -%>
  ProxyPass        /<%= path %> !
<% end -%>
  ProxyPass        /   <%= @options %>/
  ProxyPassReverse /   <%= @options %>/
