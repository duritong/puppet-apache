  <Proxy *>
<%
  if scope.call_function('guess_apache_version',[]) == '2.4'
    deny_statement = 'Require all granted'
  else
    deny_statement = 'Order deny,allow
    Allow from all'
  end
-%>    <%= deny_statement %>

<%= scope.call_function('template',['apache/vhosts/partials/authentication.erb']) %>

<% if @configuration['authenticated_location'] -%>
<% if @configuration.key?('auth_mellon') -%><%= scope.call_function('template',['apache/vhosts/partials/auth_mellon_config.erb']) %><% end -%>
  </Proxy>

  <Location <%= @configuration['authenticated_location'] %>>
<%= scope.call_function('template',['apache/vhosts/partials/authentication.erb']) %>
  </Location>
<% else -%>
<%= scope.call_function('template',['apache/vhosts/partials/authentication.erb']) %>
  </Proxy>
<% end -%>

  ProxyRequests Off
  ProxyPass        /   <%= @options %>/
  ProxyPassReverse /   <%= @options %>/
